<div class="container">
  <header class="toolbar">
    <div class="toolbar-left">
      <a routerLink="/home" class="back-button" title="Back to home">← Back</a>
      <h1>{{ title() }}</h1>
    </div>
    @if (lastSolveStats(); as stats) {
    <div class="stats">
      <span class="stat-item">{{ stats.algorithm }}</span>
      <span class="stat-item">{{ stats.nodes }} nodes</span>
      <span class="stat-item">{{ stats.timeMs.toFixed(2) }}ms</span>
    </div>
    }
  </header>

  <div class="main-content">
    <aside class="sidebar" [class.collapsed]="isCollapsed">
      <button class="collapse-toggle" (click)="isCollapsed = !isCollapsed"
        [attr.aria-label]="isCollapsed ? 'Expand sidebar' : 'Collapse sidebar'">
        <span class="toggle-icon">{{ isCollapsed ? '›' : '‹' }}</span>
      </button>

      <div class="sidebar-content">
        <section class="control-section">
          <label class="control-label">Algorithm</label>
          <select [(ngModel)]="selectedAlgorithm" class="select-input">
            <option *ngFor="let algo of algorithms" [value]="algo.key">
              {{ algo.name }}
            </option>
          </select>
        </section>

        <section class="control-section">
          <label class="control-label">Grid Size</label>
          <div class="grid-size-controls">
            <div class="size-input-group">
              <label for="cols-input" class="size-label">Columns</label>
              <input id="cols-input" type="number" [(ngModel)]="gridCols" min="10" max="200" class="number-input"
                (change)="onGridSizeChange()" />
            </div>
            <div class="size-input-group">
              <label for="rows-input" class="size-label">Rows</label>
              <input id="rows-input" type="number" [(ngModel)]="gridRows" min="10" max="200" class="number-input"
                (change)="onGridSizeChange()" />
            </div>
          </div>
        </section>

        <section class="control-section">
          <label class="control-label">Drawing Mode</label>
          <div class="button-group">
            <button *ngFor="let mode of modes" class="mode-button" [class.active]="currentMode === mode.value"
              (click)="onModeChange(mode.value)">
              {{ mode.label }}
            </button>
          </div>
        </section>

        <section class="control-section">
          <label class="control-label">Actions</label>
          <button class="action-button primary" (click)="onSolve()">
            Solve
          </button>
          <button class="action-button danger" (click)="onClear()">
            Clear Grid
          </button>
        </section>
      </div>
    </aside>

    <main class="grid-container">
      <app-grid [cols]="gridCols" [rows]="gridRows" [selectedAlgorithm]="selectedAlgorithm"
        (statsChanged)="onStatsChanged($event)">
      </app-grid>
    </main>
  </div>
</div>